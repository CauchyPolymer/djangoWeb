{% load static %}
<div class="row">
    <div class="col-xs-3 left-menu" align="center">
        <p class="large-font underline">{{ user.id }}</p>
        <div class="profile-circle"><span class="profile-char white-color">{{ user.name.0 }}</span></div>
        <p class="mypage-name x-large-font">{{ user.name }}</p>
        <p class="mypage-email small-font">{{ user.email }}</p>
        <p class="mypage-left-text medium-font">{{ user.school }} {{ user.grade }}학년</p>
    </div>
    <div class="col-xs-9" style="">
        <div class="row main-bottom main-background-color" align="center">
            <p class="main-bottom-msg white-color"><span class="x-large-font bold">{{ user.name }}</span><span class="large-font">의 실력은?</span></p>
        </div>
        <div class="row" align="center" style="margin-top: 2%; padding: 0 5% 0 5%">
            <div class="col-xs-2 x-large-font main-color bold">수1</div>
            <div class="col-xs-2 x-large-font main-color bold">수2</div>
            <div class="col-xs-2 x-large-font main-color bold">미1</div>
            <div class="col-xs-2 x-large-font main-color bold">미2</div>
            <div class="col-xs-2 x-large-font main-color bold">기벡</div>
            <div class="col-xs-2 x-large-font main-color bold">확통</div>
        </div>
        <div class="row">
            <div id="chartContainer" style="height: 50%; width: 97%;"></div>
        </div>
        <div class="row" align="right" style="padding-right: 5%">
            <div class="col-xs3 bold large-font">updated: {{ user.rate.get_updated_at }}</div>
        </div>
        <div class="row main-bottom main-background-color mypage-bottom" align="center">
            <p class="main-bottom-msg white-color mypage-bottom-msg"><span id="test" class="x-large-font bold">진단고사 보기</span></p>
        </div>

        <div class="row main-bottom main-background-color" align="center" style="margin-top: 5%;">
            <p class="main-bottom-msg white-color"><span class="x-large-font bold">{{ user.name }}</span><span class="large-font">의 진단결과는?</span></p>
        </div>
        <div class="large-font" align="center" style="margin-top: 3%">
            <span class="x-large-font">{{ user.name }}</span>의 {{ user.get_last_answer.get_created_at }}2018년 3월 24일 진단고사!
        </div>

        <div class="row" style="padding: 2% 2% 0 2%;">
            <div class="col-xs-6" align="center">
                <div class="row">
                    <div class="col-xs-12 main-blur-background-color x-large-font white-color">
                        성적표
                    </div>
                </div>
                <div class="row main-x-blur-background-color" style="padding: 5% 3% 5% 3%" align="center">
                    <div class="col-xs-3 white-color">
                        <p class="medium-font">원점수</p>
                        <p class="medium-font">96/100</p>
                    </div>
                    <div class="col-xs-3 white-color">
                        <p class="medium-font">표준점수</p>
                        <p class="medium-font">133/100</p>
                    </div>
                    <div class="col-xs-3 white-color">
                        <p class="medium-font">백분위</p>
                        <p class="medium-font">1.72%</p>
                    </div>
                    <div class="col-xs-3 white-color">
                        <p class="medium-font">등급</p>
                        <p class="medium-font">1</p>
                    </div>
                </div>
                <div class="row main-2x-blur-background-color test-result-table-div">
                    <div class="col-xs-12">
                        <table class="w3-table w3-bordered test-result-table">
                            <tr class="white-color blue-background-color">
                                <th></th>
                                <th>1</th>
                                <th>2</th>
                                <th>3</th>
                                <th>4</th>
                                <th>5</th>
                                <th>6</th>
                                <th>7</th>
                            </tr>
                            <tr>
                                <td class="small-font">답변</td>
                                <td>4</td>
                                <td>2</td>
                                <td>1</td>
                                <td>4</td>
                                <td>5</td>
                                <td>2</td>
                                <td>2</td>
                            </tr>
                            <tr>
                                <td class="small-font">정답</td>
                                <td>4</td>
                                <td>2</td>
                                <td>1</td>
                                <td>4</td>
                                <td>5</td>
                                <td>4</td>
                                <td>4</td>
                            </tr>
                            <tr>
                                <td class="small-font">채점결과</td>
                                <td>정답</td>
                                <td>정답</td>
                                <td>정답</td>
                                <td>정답</td>
                                <td>정답</td>
                                <td>오답</td>
                                <td>오답</td>
                            </tr>
                            <tr>
                                <td class="small-font">정답율</td>
                                <td>15%</td>
                                <td>5%</td>
                                <td>10%</td>
                                <td>25%</td>
                                <td>33%</td>
                                <td>56%</td>
                                <td>56%</td>
                            </tr>
                        </table>
                    </div>
                </div>
            </div>
            <div class="col-xs-6">
                <div class="row">
                    <div class="col-xs-12 blue-background-color x-large-font white-color" align="center">
                        단원별 출제 비율
                    </div>
                </div>
                <div class="row blue-blur-background-color test-chart-div">
                    <div class="col-xs-12 pie-chart-div">
                        <div id="container" class="blue-blur-background-color" style="min-width: 270px; height: 330px; max-width: 520px; margin: 0 auto"></div>
                    </div>
                </div>
                <div class="row chart-desc-div" align="center">
                    <div class="col-xs-offset-2 col-xs-3">
                        <p class="medium-font white-color">2등급</p>
                        <p class="x-large-font white-color">95</p>
                    </div>
                    <div class="col-xs-3">
                        <p class="medium-font white-color">현재점수</p>
                        <p class="x-large-font white-color">96</p>
                    </div>
                    <div class="col-xs-3">
                        <p class="medium-font white-color">1등급</p>
                        <p class="x-large-font white-color">98</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>


<script>
    history.pushState(null, null, "#mypage");
    $(window).unbind("hashchange")
    $(window).bind("hashchange", function(){
        goToMain()
    });

    $('#test').click(function () {
        $.ajax({
            url: "estimationStart/",
            type: 'GET',
            contentType: "application/json; charset=utf-8",
            success: function (result) {
                $('.main-container').empty()
                $('.main-container').append(result)
            },
        });
    })

    $.ajax({
        url: "getRateData/",
        type: 'GET',
        contentType: "application/json; charset=utf-8",
        success: function (result) {
            drawGraph(result)
        },
    });

    function drawGraph(data) {
		var chart = new CanvasJS.Chart("chartContainer",{
			title:{
				text: ""
			},
            animationEnabled: true,
			axisY:{
				reversed: true,
                labelFontSize: 30,
                interval: 1,
                minimum: 0,
                maximum: 9,
			},
            axisX:{
			    labelFontSize: 40,
                labelFontColor: "#50519C",
            },
            backgroundColor: "#E5E7F5",
			data: [{
				type: "line",
				dataPoints: data,
                markerSize: 35,
                lineThickness: 6,
                color: "#47DFBA",
			}]
		});
	    chart.render();
	}

	$(".mypage-bottom-msg").mouseover(function(){
        $(this).css("color", "#20216C");
    });
    $(".mypage-bottom-msg").mouseleave(function(){
        $(this).css("color", "white");
    });

// Make monochrome colors
var pieColors = (function () {
    var colors = [],
        base = Highcharts.getOptions().colors[0],
        i;

    for (i = 0; i < 10; i += 1) {
        // Start out with a darkened base color (negative brighten), and end
        // up with a much brighter color
        colors.push(Highcharts.Color(base).brighten((i - 3) / 7).get());
    }
    return colors;
}());

// Build the chart
Highcharts.chart('container', {
    chart: {
        plotBackgroundColor: '#5160B8',
        plotBorderWidth: null,
        plotShadow: false,
        type: 'pie',
        style: {
        }
    },
    title: {
        text: ''
    },
    tooltip: {
        pointFormat: '{series.name}: <b>{point.percentage:.1f}%</b>'
    },
    plotOptions: {
        pie: {
            allowPointSelect: true,
            cursor: 'pointer',
            colors: pieColors,
            dataLabels: {
                enabled: true,
                format: '<b>{point.name}</b>',
                distance: -50,
                filter: {
                    property: 'percentage',
                    operator: '>',
                    value: 4
                },
                style: {
                    fontSize: '15'
                }
            }
        }
    },
    series: [{
        name: 'Brands',
        data: [
            { name: '확률분포와\n통계', y: 36.33 },
            { name: '확률', y: 24.03 },
            { name: '순열과\n조합', y: 30.38 },
        ]
    }]
});

</script>