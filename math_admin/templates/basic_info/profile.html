{% load static %}
<div class="page-head">
    <!-- BEGIN PAGE TITLE -->
    <div class="page-title">
        <h1>My Profile
        </h1>
    </div>
    <!-- END PAGE TITLE -->
</div>
{#<div class="row">#}
{#    <div class="col-md-8">#}
{#        <div class="portlet light bordered">#}
{#            <span>Currently Selected Doctor: &nbsp;#}
{#                <select id="doctor">#}
{#                    <option value="{{ doctorProfile.doctorProfileSrl }}" selected>{{ doctorProfile.get_full_name }}</option>#}
{#                    {% for userDoctorProfile in userDoctorProfiles %}#}
{#                        {% if doctorProfile.doctorProfileSrl !=  userDoctorProfile.doctor.doctorProfileSrl %}#}
{#                        <option value="{{ userDoctorProfile.doctor.doctorProfileSrl }}">{{ userDoctorProfile.doctor.get_full_name }}</option>#}
{#                        {% endif %}#}
{#                    {% endfor %}#}
{#                </select>#}
{#            </span>#}
{#        </div>#}
{#    </div>#}
{#</div>#}
<div class="row">
    <div class="col-md-8">
        <div class="portlet light bordered">
            <div class="portlet-title">
                <div class="caption font-red-sunglo">
                    <i class="bold icon-user font-red-sunglo"></i>
                    <span class="caption-subject bold uppercase">  Upload photos of your profile, office, team, etc. (min 5 photos)</span>
                </div>
            </div>
            <div class="portlet-body form">
                <div id="image_list">
                    {% include "basic_info/image_list.html" %}
                </div>
                <div style="margin-top: 30px">
                    <form role="form" id="image_form" method="POST" enctype="multipart/form-data">
                        {% csrf_token %}
                        <input id="image" type="file" name="photo">
                        <div class="form-actions">
                            <button type="submit" class="btn btn-circle blue uppercase">Upload</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="row">
    <div class="col-md-8">
        <div class="portlet light bordered">
            <div class="pomrtlet-title">
                <div class="caption font-red-sunglo">
                    <i class="bold icon-user font-red-sunglo"></i>
                    <span class="caption-subject bold uppercase"> Basic Information </span>
                    <div>
                        <span class="small lowercase">
                        </span>
                    </div>
                </div>
            </div>
            <div class="portlet-body form">
                <form id="basic_form" role="form" method="POST">
                    {% include "basic_info/basic_form.html" %}
                </form>
            </div>
        </div>
            <!-- END SAMPLE FORM PORTLET-->
    </div>
</div>

<script>
    document.getElementById("image").onchange = function () {
        var reader = new FileReader();

        reader.onload = function (e) {
            // get loaded data and render thumbnail.
            document.getElementById("images").src = e.target.result;
        };

        // read the image file as a data URL.
        reader.readAsDataURL(this.files[0]);
    };

    $("#image_form").submit(function(e) {
        $(".se-pre-con").css('display', "block");

        var formData = new FormData($(this)[0]);

        $.ajax({
            url: "profile_photo/",
            type: "POST",
            data: formData,
            success: function (result) {
                $('#image_list').empty();
                $('#image_list').append($(result));
                $(".se-pre-con").fadeOut("slow");
            },
            cache: false,
            contentType: false,
            processData: false
        });

        e.preventDefault();
    });

    function isValidZipCode(zipcode){
        if (zipcode.length == 5) {
            return $.isNumeric(zipcode)
        } else {
            return $.isNumeric(String(zipcode).substring(0,5) + String(zipcode).substring(6,10)) && zipcode[5] == '-'
        }
    }

    $('#basic_form').submit(function (e) {
        var fee = String($('#fee').val()).replace(",", "")
        if(!$.isNumeric(fee)){
            alert('Please, insert only digits for Consultation fee.');
            return false;
        }

        var multiAddress = ['']
        var error = false

        $('.multi-address').each(function (i, e) {
            var addr = {}
            addr['addr'] = $(e).find('.address').val()
            addr['zipcode'] = $(e).find('.zipcode').val()
            addr['city'] = $(e).find('.city').val()
            addr['state'] = $(e).find('.state').val()
            console.log(addr)
            var isEmpty = true

            for (a in addr)
                if (addr[a] && addr[a] != '' && addr[a] != 'none')
                    isEmpty = false

            if(!isEmpty){
                if(!isValidZipCode(addr['zipcode'])){
                    alert('Please, insert correct Zip Code.')
                    error = true
                    return false
                }
                multiAddress.push(addr)
            }
        })


        if(error)
            return false

        $(".se-pre-con").css('display', "block");

        $.ajax({
            url: "save_basic_info/",
            type: "POST",
            data: {firstName: $('#firstName').val(), lastName: $('#lastName').val(), title: $('#title').val(),
                    phone: $('#phone').val(), multiAddress: JSON.stringify(multiAddress),
                    personalStatement: $('#personalStatement').val(), education: $('#education').val(),
                    expertiseArea: $('#expertiseArea').val(), boardCertifications: $('#boardCertifications').val(),
                    memberships: $('#memberships').val(), awardAndRecognition: $('#awardAndRecognition').val(),
                    language: $('#language').val(), specialOrDeals: $('#specialOrDeals').val(), fee: fee,
                    profession: $('#profession').val()},
            success: function (result) {
                $('#basic_form').empty();
                $('#basic_form').append($(result));
                $(".se-pre-con").fadeOut("slow");
                alert('Successfully Updated.')

            },
        });
        e.preventDefault();
    })

    $('#doctor').change(function () {
        $.ajax({
            url: "change_doctorProfile/?doctorProfileSrl="+$('#doctor').val(),
            method: "GET",
            contentType: "application/json; charset=utf-8",
            success: function (result) {
                $('#current_doctor').text('Currently Selected Doctor: ' + $('#doctor option:selected').text())
                $('.page-content').empty();
                $('.page-content').append(result);
            }
        });
    })

    function rotate(img_elem){
        img_elem.data('rotate', (parseInt(img_elem.data('rotate'))+90) % 360)
        img_elem.css('transform', 'rotate('+img_elem.data('rotate')+'deg)')
        if(img_elem.data('rotate') == 90 || img_elem.data('rotate') == 270) {
            img_elem.css('width', '200px')
            img_elem.css('height', '160px')
            img_elem.css('margin-top', '25px')
            img_elem.css('margin-left', '-20px')
            img_elem.css('margin-right', '-15px')
            img_elem.css('margin-bottom', '0px')
        } else {
            img_elem.css('width', '160px')
            img_elem.css('height', '200px')
            img_elem.css('margin-top', '5px')
            img_elem.css('margin-left', '0px')
            img_elem.css('margin-right', '5px')
            img_elem.css('margin-bottom', '0px')
        }
    }




</script>


